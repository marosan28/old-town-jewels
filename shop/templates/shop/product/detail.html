{% extends "shop/base.html" %}
{% load static %}
{% load humanize %}
{% load review_tags %}

{% block title %}
{{ product.name }}
{% endblock %}

{% block scripts %}
{{ block.super }}
<script src="/static/js/review_stars.js"></script>
{% endblock %}

{% block content %}
<div id="content">
  <div class="product-detail">
    <img src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'img/no_image.png' %}{% endif %}"
      alt="product-image">
    <span class="product-description">{{ product.description }}</span>
    <h1>{{ product.name }}</h1>
    <h2><a href="{{ product.category.get_absolute_url }}">{{ product.category }}</a></h2>
    <p class="price">â‚¬{{ product.price }}</p>

    <form action="{% url 'cart:cart_add' product.id %}" method="post">
      {{ cart_product_form }}
      {% csrf_token %}
      <input type="submit" value="Add to cart">
    </form>

    {% with reviews.count as total_reviews %}
  <h3><strong>{{ total_reviews }} review{{ total_reviews|pluralize }}</strong></h3>
{% endwith %}

{% if reviews %}
  {% with reviews|average_review as avg_review %}
  <div class="review-stars" id="review-{{ review.id }}-stars">
    <p>Average review: {{ avg_review }}  <span class="fa fa-star star-selected"></span></p>
  </div>
  {% endwith %}
{% endif %}


  {% include "shop/includes/review_form.html" %}


  {% for review in reviews %}
    <div class="card my-3">
      <div class="card-body">
        <h5 class="card-title">{{ review.name }}</h5>
        <h6 class="card-subtitle mb-2 text-muted">{{ review.created }} </h6>
        <div class="review-stars" id="review-{{ review.id }}-stars">
          {% for i in "x"|rjust:review.rating %}
            <span class="fa fa-star star-selected"></span>
          {% endfor %}
        </div>
        <p class="card-text">{{ review.body }}</p>
      </div>
    </div>
  {% empty %}
    <p>There are no reviews.</p>
  {% endfor %}
  

  


   
  </div>
</div>
{% endblock %}